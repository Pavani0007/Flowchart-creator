<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowchart Builder | Create Beautiful Flowcharts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #4a6bff;
            text-decoration: none;
        }

        .logo i {
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #4a6bff;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        /* Button Styles */
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #4a6bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3a5bef;
        }

        .btn-outline {
            background-color: transparent;
            border-color: #4a6bff;
            color: #4a6bff;
        }

        .btn-outline:hover {
            background-color: #4a6bff;
            color: white;
        }

        .btn-large {
            padding: 12px 24px;
            font-size: 1.1rem;
        }

        /* Hero Section */
        .hero {
            padding: 180px 0 80px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .hero p {
            font-size: 1.2rem;
            color: #7f8c8d;
            max-width: 700px;
            margin: 0 auto 40px;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 50px;
        }

        .hero-image img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Signup Section */
        .signup-container {
            display: flex;
            gap: 40px;
            margin: 80px auto;
        }

        .signup-section, .free-access-section {
            flex: 1;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .signup-section h2, .free-access-section h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #4a6bff;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .terms {
            margin-top: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .benefits {
            margin-top: 30px;
        }

        .benefits p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .benefits i {
            color: #4a6bff;
        }

        /* Flowchart Editor Styles */
        .editor-container {
            display: none;
            margin-top: 80px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .toolbar {
            background-color: #2c3e50;
            padding: 10px;
            display: flex;
            gap: 10px;
        }

        .toolbar button {
            background-color: #34495e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toolbar button:hover {
            background-color: #4a6bff;
        }

        .workspace {
            display: flex;
            height: 600px;
        }

        .palette {
            width: 200px;
            background-color: #f8f9fa;
            padding: 15px;
            border-right: 1px solid #ddd;
        }

        .palette-item {
            background-color: white;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: grab;
            text-align: center;
        }

        .palette-item:hover {
            background-color: #f0f0f0;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: auto;
            background-color: #f9f9f9;
            background-image: linear-gradient(#eee 1px, transparent 1px),
                              linear-gradient(90deg, #eee 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #flowchart-canvas {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .flowchart-element {
            position: absolute;
            background-color: white;
            border: 2px solid #4a6bff;
            border-radius: 6px;
            padding: 10px;
            cursor: move;
            min-width: 100px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            user-select: none;
        }

        .flowchart-element.selected {
            border-color: #ff6b4a;
            box-shadow: 0 0 0 2px rgba(255, 107, 74, 0.3);
        }

        .connection {
            position: absolute;
            pointer-events: none;
        }

        .arrow-label {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 2px 5px;
            min-width: 20px;
            cursor: text;
            z-index: 100;
            font-size: 12px;
        }

        .properties-panel {
            width: 250px;
            background-color: white;
            border-left: 1px solid #ddd;
            padding: 15px;
            overflow-y: auto;
        }

        .properties-panel h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .property-group {
            margin-bottom: 15px;
        }

        .property-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .status-bar {
            background-color: #2c3e50;
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .signup-container {
                flex-direction: column;
            }
            
            .hero-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .workspace {
                flex-direction: column;
                height: auto;
            }
            
            .palette, .properties-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <a href="#" class="logo">
                    <i class="fas fa-project-diagram"></i>
                    Flowchart Builder
                </a>
                
                <ul class="nav-links">
                    <li><a href="#">Home</a></li>
                    <li><a href="#signup">Sign Up</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
                
                <div class="nav-buttons">
                    <button class="btn btn-outline" id="login-btn">Login</button>
                    <button class="btn btn-primary" id="signup-btn">Sign Up</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Create Beautiful Flowcharts with Ease</h1>
            <p>Design professional flowcharts, diagrams, and processes in minutes with our intuitive drag-and-drop interface.</p>
            
            <div class="hero-buttons">
                <a href="#signup" class="btn btn-primary btn-large">
                    <i class="fas fa-user-plus"></i> Sign Up Now
                </a>
                <a href="#try-free" class="btn btn-outline btn-large">
                    <i class="fas fa-rocket"></i> Try It Free
                </a>
            </div>
            
            <div class="hero-image">
                <img src="https://via.placeholder.com/900x500?text=Flowchart+Builder+Screenshot" alt="Flowchart Builder Interface">
            </div>
        </div>
    </section>

    <!-- Signup Options -->
    <section id="signup" class="container">
        <div class="signup-container">
            <!-- Full Signup Section -->
            <div class="signup-section">
                <h2>Create Your Account</h2>
                <form id="full-signup-form">
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" class="form-control" placeholder="John Doe" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" class="form-control" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="••••••••" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <input type="password" id="confirm-password" class="form-control" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                    
                    <div class="terms">
                        <small>By signing up, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></small>
                    </div>
                </form>
            </div>
            
            <!-- Free Access Section -->
            <div id="try-free" class="free-access-section">
                <h3>Get Started Free</h3>
                <p>Start creating immediately with no registration required</p>
                
                <button class="btn btn-outline btn-large" id="free-access-btn">
                    <i class="fas fa-play"></i> Launch Flowchart Builder
                </button>
                
                <div class="benefits">
                    <p><i class="fas fa-check-circle"></i> No credit card required</p>
                    <p><i class="fas fa-check-circle"></i> Access all basic features</p>
                    <p><i class="fas fa-check-circle"></i> Save up to 3 projects</p>
                    <p><i class="fas fa-check-circle"></i> Export as PNG/JPEG</p>
                </div>
                
                <p><small>Upgrade anytime for more features and unlimited projects</small></p>
            </div>
        </div>
    </section>

    <!-- Flowchart Editor (Initially Hidden) -->
    <div class="editor-container" id="editor-container">
        <div class="toolbar">
            <button id="save-btn"><i class="fas fa-save"></i> Save</button>
            <button id="export-btn"><i class="fas fa-download"></i> Export</button>
            <button id="clear-btn"><i class="fas fa-trash"></i> Clear</button>
            <button id="undo-btn"><i class="fas fa-undo"></i> Undo</button>
            <button id="redo-btn"><i class="fas fa-redo"></i> Redo</button>
        </div>
        
        <div class="workspace">
            <div class="palette">
                <h3>Shapes</h3>
                <div class="palette-item" draggable="true" data-type="rectangle">
                    <i class="fas fa-square"></i> Rectangle
                </div>
                <div class="palette-item" draggable="true" data-type="diamond">
                    <i class="fas fa-diamond"></i> Diamond
                </div>
                <div class="palette-item" draggable="true" data-type="ellipse">
                    <i class="fas fa-circle"></i> Ellipse
                </div>
                <div class="palette-item" draggable="true" data-type="rounded">
                    <i class="fas fa-square"></i> Rounded
                </div>
                
                <h3 style="margin-top: 20px;">Connectors</h3>
                <div class="palette-item" draggable="true" data-type="arrow">
                    <i class="fas fa-arrow-right"></i> Arrow
                </div>
            </div>
            
            <div class="canvas-container" id="canvas-container">
                <div id="flowchart-canvas"></div>
            </div>
            
            <div class="properties-panel" id="properties-panel">
                <h3>Properties</h3>
                <p>Select an element to edit its properties.</p>
                
                <div id="element-properties" style="display: none;">
                    <div class="property-group">
                        <label for="element-text">Text</label>
                        <input type="text" id="element-text" class="form-control">
                    </div>
                    
                    <div class="property-group">
                        <label for="element-color">Background Color</label>
                        <input type="color" id="element-color" class="form-control" value="#ffffff">
                    </div>
                    
                    <div class="property-group">
                        <label for="element-border-color">Border Color</label>
                        <input type="color" id="element-border-color" class="form-control" value="#4a6bff">
                    </div>
                    
                    <button id="delete-element" class="btn btn-outline" style="width: 100%; margin-top: 20px;">
                        <i class="fas fa-trash"></i> Delete Element
                    </button>
                </div>
                
                <div id="connection-properties" style="display: none;">
                    <div class="property-group">
                        <label for="connection-label">Label</label>
                        <input type="text" id="connection-label" class="form-control">
                    </div>
                    
                    <div class="property-group">
                        <label for="connection-color">Color</label>
                        <input type="color" id="connection-color" class="form-control" value="#4a6bff">
                    </div>
                    
                    <button id="delete-connection" class="btn btn-outline" style="width: 100%; margin-top: 20px;">
                        <i class="fas fa-trash"></i> Delete Connection
                    </button>
                </div>
            </div>
        </div>
        
        <div class="status-bar" id="status-bar">
            Ready
        </div>
    </div>

    <script>
        // Handle form submission for full signup
        document.getElementById('full-signup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const name = document.getElementById('full-name').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Here you would typically:
            // 1. Validate inputs
            // 2. Send data to your backend
            // 3. Handle the response
            
            // For this demo, we'll just redirect after a short delay
            setTimeout(() => {
                window.location.href = 'something.html';
            }, 1000);
            
            // Show success message (optional)
            alert('Account created successfully! Redirecting to the editor...');
        });
        
        // Simple navigation for header buttons
        document.getElementById('signup-btn').addEventListener('click', function() {
            document.getElementById('signup').scrollIntoView({ behavior: 'smooth' });
        });

        // Show editor when free access button is clicked
        document.getElementById('free-access-btn').addEventListener('click', function() {
            document.getElementById('editor-container').style.display = 'block';
            document.getElementById('signup').style.display = 'none';
            document.querySelector('.hero').style.display = 'none';
            
            // Initialize flowchart editor
            initFlowchartEditor();
            
            // Scroll to editor
            document.getElementById('editor-container').scrollIntoView({ behavior: 'smooth' });
        });

        // Flowchart Editor Logic
        function initFlowchartEditor() {
            const canvas = document.getElementById('flowchart-canvas');
            const propertiesPanel = document.getElementById('properties-panel');
            const statusBar = document.getElementById('status-bar');
            
            let elements = [];
            let connections = [];
            let selectedElement = null;
            let selectedConnection = null;
            let nextId = 1;
            let isDragging = false;
            let startX, startY;
            let dragOffsetX, dragOffsetY;
            let isCreatingConnection = false;
            let connectionStartElement = null;
            let tempConnection = null;
            
            // Show status message
            function showStatusMessage(message, isError = false) {
                statusBar.textContent = message;
                statusBar.style.color = isError ? '#ff6b4a' : 'white';
            }
            
            // Create a new flowchart element
            function createElement(type, x, y) {
                const element = document.createElement('div');
                element.className = 'flowchart-element';
                element.dataset.id = nextId++;
                element.dataset.type = type;
                
                // Set initial position
                element.style.left = `${x}px`;
                element.style.top = `${y}px`;
                
                // Set different shapes based on type
                switch(type) {
                    case 'rectangle':
                        element.innerHTML = '<div contenteditable="true">Process</div>';
                        break;
                    case 'diamond':
                        element.innerHTML = '<div contenteditable="true">Decision</div>';
                        element.style.transform = 'rotate(45deg)';
                        element.style.width = '80px';
                        element.style.height = '80px';
                        element.style.display = 'flex';
                        element.style.alignItems = 'center';
                        element.style.justifyContent = 'center';
                        break;
                    case 'ellipse':
                        element.innerHTML = '<div contenteditable="true" style="text-align: center;">Terminator</div>';
                        element.style.borderRadius = '50%';
                        break;
                    case 'rounded':
                        element.innerHTML = '<div contenteditable="true">Process</div>';
                        element.style.borderRadius = '15px';
                        break;
                }
                
                // Add event listeners
                element.addEventListener('mousedown', startElementDrag);
                element.addEventListener('click', selectElement);
                
                // Add to canvas
                canvas.appendChild(element);
                
                // Store element data
                const elementData = {
                    id: element.dataset.id,
                    type: type,
                    x: x,
                    y: y,
                    text: 'Process',
                    color: '#ffffff',
                    borderColor: '#4a6bff',
                    element: element
                };
                
                elements.push(elementData);
                return elementData;
            }
            
            // Start dragging an element
            function startElementDrag(e) {
                if (e.target.getAttribute('contenteditable') === 'true') return;
                
                e.preventDefault();
                e.stopPropagation();
                
                isDragging = true;
                selectedElement = elements.find(el => el.element === this);
                
                // Calculate offset
                const rect = this.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                // Bring to front
                this.style.zIndex = '10';
                
                document.addEventListener('mousemove', dragElement);
                document.addEventListener('mouseup', stopElementDrag);
            }
            
            // Drag element
            function dragElement(e) {
                if (!isDragging) return;
                
                const x = e.clientX - dragOffsetX - canvas.getBoundingClientRect().left;
                const y = e.clientY - dragOffsetY - canvas.getBoundingClientRect().top;
                
                selectedElement.element.style.left = `${x}px`;
                selectedElement.element.style.top = `${y}px`;
                
                // Update connections
                updateConnections();
            }
            
            // Stop dragging element
            function stopElementDrag() {
                if (!isDragging) return;
                
                isDragging = false;
                selectedElement.element.style.zIndex = '1';
                
                // Update element position in data
                const rect = selectedElement.element.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                selectedElement.x = rect.left - canvasRect.left;
                selectedElement.y = rect.top - canvasRect.top;
                
                document.removeEventListener('mousemove', dragElement);
                document.removeEventListener('mouseup', stopElementDrag);
            }
            
            // Select an element
            function selectElement(e) {
                if (e.target.getAttribute('contenteditable') === 'true') return;
                
                e.stopPropagation();
                
                // Deselect previous selection
                if (selectedElement) {
                    selectedElement.element.classList.remove('selected');
                }
                if (selectedConnection) {
                    selectedConnection.element.classList.remove('selected');
                }
                
                // Select this element
                selectedElement = elements.find(el => el.element === this);
                selectedElement.element.classList.add('selected');
                selectedConnection = null;
                
                // Update properties panel
                showElementProperties(selectedElement);
            }
            
            // Show element properties in panel
            function showElementProperties(element) {
                document.getElementById('element-properties').style.display = 'block';
                document.getElementById('connection-properties').style.display = 'none';
                
                document.getElementById('element-text').value = element.element.textContent.trim();
                document.getElementById('element-color').value = element.color;
                document.getElementById('element-border-color').value = element.borderColor;
                
                // Set up property change listeners
                document.getElementById('element-text').oninput = function() {
                    element.element.querySelector('div').textContent = this.value;
                    element.text = this.value;
                };
                
                document.getElementById('element-color').onchange = function() {
                    element.element.style.backgroundColor = this.value;
                    element.color = this.value;
                };
                
                document.getElementById('element-border-color').onchange = function() {
                    element.element.style.borderColor = this.value;
                    element.borderColor = this.value;
                };
                
                document.getElementById('delete-element').onclick = function() {
                    if (confirm('Delete this element?')) {
                        deleteElement(element);
                    }
                };
            }
            
            // Delete an element
            function deleteElement(element) {
                // Remove all connections to/from this element
                connections = connections.filter(conn => {
                    if (conn.from === element.id || conn.to === element.id) {
                        if (conn.element && conn.element.parentNode) {
                            conn.element.parentNode.removeChild(conn.element);
                        }
                        if (conn.labelElement && conn.labelElement.parentNode) {
                            conn.labelElement.parentNode.removeChild(conn.labelElement);
                        }
                        return false;
                    }
                    return true;
                });
                
                // Remove the element
                if (element.element.parentNode) {
                    element.element.parentNode.removeChild(element.element);
                }
                
                // Remove from elements array
                elements = elements.filter(el => el.id !== element.id);
                
                // Clear properties panel
                document.getElementById('element-properties').style.display = 'none';
                selectedElement = null;
                
                showStatusMessage('Element deleted');
            }
            
            // Create a connection between two elements
            function createConnection(fromElement, toElement) {
                const connection = {
                    id: nextId++,
                    from: fromElement.id,
                    to: toElement.id,
                    label: "",
                    color: "#4a6bff",
                    element: null,
                    labelElement: null
                };
                
                // Create SVG path for the arrow
                const arrowElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                arrowElement.classList.add('connection');
                arrowElement.style.position = 'absolute';
                arrowElement.style.overflow = 'visible';
                arrowElement.style.pointerEvents = 'none';
                arrowElement.dataset.id = connection.id;
                
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute('stroke', connection.color);
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');
                path.setAttribute('marker-end', 'url(#arrowhead)');
                
                arrowElement.appendChild(path);
                
                // Create label element
                const labelElement = document.createElement("div");
                labelElement.className = "arrow-label";
                labelElement.contentEditable = true;
                labelElement.textContent = "Double-click to edit";
                labelElement.style.display = "none"; // Initially hidden
                
                // Add event listeners for label
                labelElement.addEventListener("dblclick", (e) => {
                    e.stopPropagation();
                    labelElement.focus();
                });
                
                labelElement.addEventListener("blur", () => {
                    connection.label = labelElement.textContent;
                });
                
                labelElement.addEventListener("click", (e) => {
                    e.stopPropagation();
                    selectConnection(connection);
                });
                
                // Add to DOM
                canvas.appendChild(arrowElement);
                canvas.appendChild(labelElement);
                
                // Store references
                connection.element = arrowElement;
                connection.labelElement = labelElement;
                
                connections.push(connection);
                updateConnection(connection);
                
                return connection;
            }
            
            // Update connection position
            function updateConnection(connection) {
                const fromElement = elements.find(el => el.id === connection.from);
                const toElement = elements.find(el => el.id === connection.to);
                
                if (!fromElement || !toElement) return;
                
                const fromRect = fromElement.element.getBoundingClientRect();
                const toRect = toElement.element.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                // Calculate positions relative to canvas
                const fromX = fromRect.left - canvasRect.left + fromRect.width / 2;
                const fromY = fromRect.top - canvasRect.top + fromRect.height / 2;
                const toX = toRect.left - canvasRect.left + toRect.width / 2;
                const toY = toRect.top - canvasRect.top + toRect.height / 2;
                
                // Calculate angle between points
                const angle = Math.atan2(toY - fromY, toX - fromX);
                
                // Adjust start and end points to element edges
                const radiusFrom = Math.min(fromRect.width, fromRect.height) / 2;
                const radiusTo = Math.min(toRect.width, toRect.height) / 2;
                
                const adjustedFromX = fromX + Math.cos(angle) * radiusFrom;
                const adjustedFromY = fromY + Math.sin(angle) * radiusFrom;
                const adjustedToX = toX - Math.cos(angle) * radiusTo;
                const adjustedToY = toY - Math.sin(angle) * radiusTo;
                
                // Update path
                const path = connection.element.querySelector('path');
                path.setAttribute('d', `M${adjustedFromX},${adjustedFromY} L${adjustedToX},${adjustedToY}`);
                
                // Position label at midpoint
                const midX = (adjustedFromX + adjustedToX) / 2;
                const midY = (adjustedFromY + adjustedToY) / 2;
                
                connection.labelElement.style.left = `${midX}px`;
                connection.labelElement.style.top = `${midY}px`;
                connection.labelElement.style.display = "block";
            }
            
            // Update all connections
            function updateConnections() {
                connections.forEach(conn => updateConnection(conn));
            }
            
            // Select a connection
            function selectConnection(connection) {
                // Deselect previous selection
                if (selectedElement) {
                    selectedElement.element.classList.remove('selected');
                    selectedElement = null;
                }
                if (selectedConnection) {
                    selectedConnection.element.classList.remove('selected');
                }
                
                // Select this connection
                selectedConnection = connection;
                connection.element.classList.add('selected');
                
                // Update properties panel
                showConnectionProperties(connection);
            }
            
            // Show connection properties in panel
            function showConnectionProperties(connection) {
                document.getElementById('element-properties').style.display = 'none';
                document.getElementById('connection-properties').style.display = 'block';
                
                document.getElementById('connection-label').value = connection.label;
                document.getElementById('connection-color').value = connection.color;
                
                // Set up property change listeners
                document.getElementById('connection-label').oninput = function() {
                    connection.labelElement.textContent = this.value;
                    connection.label = this.value;
                };
                
                document.getElementById('connection-color').onchange = function() {
                    const path = connection.element.querySelector('path');
                    path.setAttribute('stroke', this.value);
                    connection.color = this.value;
                };
                
                document.getElementById('delete-connection').onclick = function() {
                    if (confirm('Delete this connection?')) {
                        deleteConnection(connection);
                    }
                };
            }
            
            // Delete a connection
            function deleteConnection(connection) {
                // Remove from DOM
                if (connection.element.parentNode) {
                    connection.element.parentNode.removeChild(connection.element);
                }
                if (connection.labelElement.parentNode) {
                    connection.labelElement.parentNode.removeChild(connection.labelElement);
                }
                
                // Remove from connections array
                connections = connections.filter(conn => conn.id !== connection.id);
                
                // Clear properties panel
                document.getElementById('connection-properties').style.display = 'none';
                selectedConnection = null;
                
                showStatusMessage('Connection deleted');
            }
            
            // Start creating a connection
            function startConnection(e) {
                if (e.target.classList.contains('flowchart-element')) {
                    isCreatingConnection = true;
                    connectionStartElement = elements.find(el => el.element === e.target);
                    
                    // Create temporary connection element
                    tempConnection = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    tempConnection.classList.add('connection');
                    tempConnection.style.position = 'absolute';
                    tempConnection.style.overflow = 'visible';
                    tempConnection.style.pointerEvents = 'none';
                    
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute('stroke', '#4a6bff');
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke-dasharray', '5,5');
                    
                    tempConnection.appendChild(path);
                    canvas.appendChild(tempConnection);
                    
                    document.addEventListener('mousemove', drawTempConnection);
                    document.addEventListener('mouseup', finishConnection);
                }
            }
            
            // Draw temporary connection while dragging
            function drawTempConnection(e) {
                if (!isCreatingConnection) return;
                
                const startRect = connectionStartElement.element.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                const startX = startRect.left - canvasRect.left + startRect.width / 2;
                const startY = startRect.top - canvasRect.top + startRect.height / 2;
                const endX = e.clientX - canvasRect.left;
                const endY = e.clientY - canvasRect.top;
                
                const path = tempConnection.querySelector('path');
                path.setAttribute('d', `M${startX},${startY} L${endX},${endY}`);
            }
            
            // Finish creating a connection
            function finishConnection(e) {
                if (!isCreatingConnection) return;
                
                isCreatingConnection = false;
                
                // Remove temp connection
                if (tempConnection.parentNode) {
                    tempConnection.parentNode.removeChild(tempConnection);
                }
                
                // Check if we're connecting to another element
                if (e.target.classList.contains('flowchart-element')) {
                    const endElement = elements.find(el => el.element === e.target);
                    
                    // Don't allow self-connections
                    if (connectionStartElement.id !== endElement.id) {
                        // Create the actual connection
                        const connection = createConnection(connectionStartElement, endElement);
                        selectConnection(connection);
                        showStatusMessage('Connection created');
                    }
                }
                
                document.removeEventListener('mousemove', drawTempConnection);
                document.removeEventListener('mouseup', finishConnection);
            }
            
            // Clear canvas
            function clearCanvas() {
                const saveFirst = confirm('Do you want to save the flowchart as an image before clearing?');
                
                if (saveFirst) {
                    // In a real app, you would implement html2canvas or similar
                    alert('Export functionality would be implemented here');
                    
                    // After saving, clear the canvas
                    performClear();
                    showStatusMessage('Canvas cleared (image saved)');
                } else {
                    // Just clear without saving
                    performClear();
                    showStatusMessage('Canvas cleared');
                }
            }
            
            // Helper function to perform the actual canvas clearing
            function performClear() {
                // Remove all elements
                elements.forEach(el => {
                    if (el.element && el.element.parentNode) {
                        el.element.parentNode.removeChild(el.element);
                    }
                });
                
                // Remove all connections
                connections.forEach(conn => {
                    if (conn.element && conn.element.parentNode) {
                        conn.element.parentNode.removeChild(conn.element);
                    }
                    if (conn.labelElement && conn.labelElement.parentNode) {
                        conn.labelElement.parentNode.removeChild(conn.labelElement);
                    }
                });
                
                // Reset state
                elements = [];
                connections = [];
                selectedElement = null;
                selectedConnection = null;
                nextId = 1;
                
                // Reset properties panel
                document.getElementById('element-properties').style.display = 'none';
document.getElementById('connection-properties').style.display = 'none';
}
        // Set up palette items for drag and drop
        const paletteItems = document.querySelectorAll('.palette-item');
        paletteItems.forEach(item => {
            item.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('type', this.dataset.type);
            });
        });

        // Handle canvas drop
        canvas.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        canvas.addEventListener('drop', function(e) {
            e.preventDefault();
            const type = e.dataTransfer.getData('type');
            
            if (type) {
                const canvasRect = canvas.getBoundingClientRect();
                const x = e.clientX - canvasRect.left - 50;
                const y = e.clientY - canvasRect.top - 30;
                
                if (type === 'arrow') {
                    // For arrows, we'll start connection mode
                    showStatusMessage('Click on first element, then drag to second element to create connection');
                } else {
                    // Create a new element
                    createElement(type, x, y);
                    showStatusMessage(`${type} element created`);
                }
            }
        });

        // Set up canvas click for connection mode
        canvas.addEventListener('mousedown', startConnection);

        // Set up toolbar buttons
        document.getElementById('clear-btn').addEventListener('click', clearCanvas);
        document.getElementById('export-btn').addEventListener('click', function() {
            alert('Export functionality would be implemented here');
            showStatusMessage('Export initiated');
        });

        document.getElementById('save-btn').addEventListener('click', function() {
            alert('Save functionality would be implemented here');
            showStatusMessage('Diagram saved');
        });

        // Add arrowhead marker definition to canvas
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute('id', 'arrowhead');
        marker.setAttribute('markerWidth', '10');
        marker.setAttribute('markerHeight', '7');
        marker.setAttribute('refX', '9');
        marker.setAttribute('refY', '3.5');
        marker.setAttribute('orient', 'auto');
        
        const arrowhead = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        arrowhead.setAttribute('points', '0 0, 10 3.5, 0 7');
        arrowhead.setAttribute('fill', '#4a6bff');
        
        marker.appendChild(arrowhead);
        defs.appendChild(marker);
        
        // Add to a hidden SVG that contains our definitions
        const svgDefs = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svgDefs.style.position = 'absolute';
        svgDefs.style.width = '0';
        svgDefs.style.height = '0';
        svgDefs.style.overflow = 'hidden';
        svgDefs.appendChild(defs);
        document.body.appendChild(svgDefs);

        // Initialize with some sample elements
        const startElement = createElement('ellipse', 100, 100);
        startElement.element.querySelector('div').textContent = 'Start';
        
        const processElement = createElement('rectangle', 300, 120);
        processElement.element.querySelector('div').textContent = 'Process';
        
        const decisionElement = createElement('diamond', 500, 100);
        decisionElement.element.querySelector('div').textContent = 'Decision';
        
        const endElement = createElement('ellipse', 700, 100);
        endElement.element.querySelector('div').textContent = 'End';
        
        // Create some sample connections
        const conn1 = createConnection(startElement, processElement);
        conn1.label = 'Begin';
        conn1.labelElement.textContent = 'Begin';
        
        const conn2 = createConnection(processElement, decisionElement);
        conn2.label = 'Next step';
        conn2.labelElement.textContent = 'Next step';
        
        const conn3 = createConnection(decisionElement, endElement);
        conn3.label = 'Yes';
        conn3.labelElement.textContent = 'Yes';
        
        showStatusMessage('Flowchart editor ready. Drag shapes from the palette or click to select elements.');
    }
</script>